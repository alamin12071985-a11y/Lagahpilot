<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laga Host | Premium Bot Solution</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;800&display=swap" rel="stylesheet">
    <link href="https://unpkg.com/lucide@latest/font/lucide.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-dark: #09090b;
            --bg-card: #18181b;
            --primary: #6A5ACD; /* Aurora Violet */
            --accent: #00E5FF;  /* Electric Ice */
            --text-main: #f8fafc;
            --text-muted: #a1a1aa;
            
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            overflow-x: hidden;
            background-image: radial-gradient(circle at top right, #1e1b4b 0%, transparent 40%);
        }

        /* --- Components --- */
        .glass-card {
            background: rgba(24, 24, 27, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(106, 90, 205, 0.2);
            border-radius: 16px;
            transition: all 0.3s ease;
        }
        .glass-card:hover {
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(0, 229, 255, 0.15);
            transform: translateY(-2px);
        }

        .btn-laga {
            background: var(--gradient);
            color: #000;
            font-weight: 700;
            border: none;
            padding: 12px 28px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0, 229, 255, 0.3);
            transition: 0.3s;
        }
        .btn-laga:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(106, 90, 205, 0.5);
            color: #000;
        }

        .text-gradient {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .feature-lock {
            position: relative;
            filter: grayscale(1);
            opacity: 0.6;
            pointer-events: none;
        }
        .lock-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            z-index: 10; color: var(--accent);
            background: rgba(0,0,0,0.8); padding: 10px; border-radius: 50%;
        }

        /* Landing Page */
        #landingView {
            height: 100vh;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            text-align: center;
        }
        .hero-title { font-size: 4rem; font-weight: 800; line-height: 1.1; }

        /* Sidebar & Layout */
        .sidebar { width: 280px; height: 100vh; position: fixed; background: var(--bg-card); border-right: 1px solid rgba(255,255,255,0.05); z-index: 100; }
        .main-content { margin-left: 280px; padding: 2rem; }

        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; padding: 1rem; }
            .hero-title { font-size: 2.5rem; }
        }
    </style>
</head>
<body>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script>
    // ‚ö†Ô∏è YOUR PROVIDED CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyD1PPDhogcw7fBu27PkO1iuMfGFLUwMN70",
      authDomain: "fir-55206.firebaseapp.com",
      databaseURL: "https://fir-55206-default-rtdb.firebaseio.com",
      projectId: "fir-55206",
      storageBucket: "fir-55206.firebasestorage.app",
      messagingSenderId: "24586463698",
      appId: "1:24586463698:web:8b2f21073295ef4382400b",
      measurementId: "G-K676BWHYR4"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const googleProvider = new firebase.auth.GoogleAuthProvider();
</script>

<!-- ================= LANDING PAGE ================= -->
<div id="landingView">
    <div class="container">
        <div class="mb-3 p-3 rounded-circle d-inline-block" style="background: rgba(106, 90, 205, 0.2)">
            <i data-lucide="zap" size="48" style="color: var(--accent)"></i>
        </div>
        <h1 class="hero-title mb-3">Laga <span class="text-gradient">Host</span></h1>
        <p class="text-muted fs-5 mb-5">‡¶ï‡¶•‡¶æ ‡¶ï‡¶Æ, ‡¶ï‡¶æ‡¶ú ‡¶¨‡ßá‡¶∂‡¶ø ‚Äî Ultimate Bot Hosting Solution.</p>
        
        <button class="btn btn-laga btn-lg d-flex align-items-center gap-2 mx-auto" onclick="googleLogin()">
            <i data-lucide="log-in"></i> ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>
        
        <div class="mt-5 d-flex justify-content-center gap-4 text-muted small">
            <span><i data-lucide="shield" size="14" class="text-success"></i> IP Secured</span>
            <span><i data-lucide="server" size="14" class="text-info"></i> 99.9% Uptime</span>
        </div>
    </div>
</div>

<!-- ================= DASHBOARD PAGE ================= -->
<div id="dashboardView" style="display: none;">
    <!-- Sidebar -->
    <div class="sidebar p-4 d-flex flex-column">
        <h3 class="fw-bold mb-5"><span style="color: var(--primary)">Laga</span> <span style="color: var(--accent)">Host</span></h3>
        
        <div class="nav flex-column gap-3">
            <a href="#" class="nav-link text-white glass-card"><i data-lucide="layout-grid" class="me-2 text-accent"></i> Dashboard</a>
            <a href="#" class="nav-link text-muted"><i data-lucide="terminal" class="me-2"></i> Commands</a>
            <a href="#" class="nav-link text-muted"><i data-lucide="file-text" class="me-2"></i> Logs</a>
            <a href="#" class="nav-link text-muted" onclick="showPaymentModal()"><i data-lucide="crown" class="me-2 text-warning"></i> Upgrade</a>
            <a href="#" class="nav-link text-muted"><i data-lucide="settings" class="me-2"></i> Settings</a>
        </div>

        <div class="mt-auto">
            <div class="glass-card p-3 mb-3 border-0" style="background: rgba(255,255,255,0.05)">
                <small class="text-muted d-block">Current Plan</small>
                <h5 class="fw-bold m-0 text-gradient text-uppercase" id="userPlanDisplay">FREE</h5>
            </div>
            <button class="btn btn-outline-danger w-100 btn-sm rounded-pill" onclick="logout()">Logout</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="fw-bold m-0">Dashboard</h2>
                <small class="text-muted">Manage your automation empire.</small>
            </div>
            <button class="btn btn-laga btn-sm" data-bs-toggle="modal" data-bs-target="#createBotModal">
                <i data-lucide="plus"></i> New Bot
            </button>
        </div>

        <!-- Stats -->
        <div class="row g-4 mb-4">
            <div class="col-md-4">
                <div class="glass-card p-4">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h2 class="fw-bold m-0" id="totalUsers">0</h2>
                            <small class="text-muted text-uppercase">Total Users</small>
                        </div>
                        <i data-lucide="users" style="color: var(--primary)" size="32"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="glass-card p-4">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h2 class="fw-bold m-0" style="color: var(--accent)" id="activeUsers">0</h2>
                            <small class="text-muted text-uppercase">Active Now</small>
                        </div>
                        <i data-lucide="activity" style="color: var(--accent)" size="32"></i>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="glass-card p-4">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h2 class="fw-bold m-0 text-success" id="weeklyGrowth">0</h2>
                            <small class="text-muted text-uppercase">Weekly Growth</small>
                        </div>
                        <i data-lucide="trending-up" class="text-success" size="32"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bots & Chart -->
        <div class="row g-4">
            <div class="col-lg-8">
                <div class="glass-card p-4 h-100">
                    <h5 class="fw-bold mb-4">Traffic Overview</h5>
                    <canvas id="trafficChart" height="120"></canvas>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="glass-card p-4 h-100">
                    <h5 class="fw-bold mb-4">Your Bots</h5>
                    <div id="botListContainer" class="d-flex flex-column gap-3" style="max-height: 300px; overflow-y: auto;">
                        <div class="text-center text-muted py-5">
                            <i data-lucide="ghost" size="24" class="mb-2"></i><br>No active bots
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Locked Features Demo -->
        <div class="row g-4 mt-2">
            <div class="col-md-6">
                <div class="glass-card p-4 feature-lock" id="lockLogs">
                    <div class="lock-icon"><i data-lucide="lock"></i></div>
                    <h5>Live Console Logs</h5>
                    <div style="height: 80px; background: #000; border-radius: 8px;"></div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="glass-card p-4 feature-lock" id="lockSettings">
                    <div class="lock-icon"><i data-lucide="lock"></i></div>
                    <h5>Advanced API Settings</h5>
                    <div style="height: 80px; background: #1f1f22; border-radius: 8px;"></div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- ================= MODALS ================= -->

<!-- Payment Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-card border-0" style="background: #18181b; color: white;">
            <div class="modal-header border-0">
                <h5 class="modal-title fw-bold">Upgrade Plan üíé</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3 mb-4">
                    <div class="col-6">
                        <div class="p-3 text-center border rounded" style="border-color: var(--primary) !important;">
                            <h5 style="color: var(--primary)">PRO</h5>
                            <h3 class="fw-bold">250‡ß≥</h3>
                            <small class="text-muted">5 Bots</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="p-3 text-center border rounded" style="border-color: var(--accent) !important;">
                            <h5 style="color: var(--accent)">VIP</h5>
                            <h3 class="fw-bold">500‡ß≥</h3>
                            <small class="text-muted">Unlimited</small>
                        </div>
                    </div>
                </div>
                
                <div class="p-3 rounded mb-3" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3);">
                    <div class="d-flex align-items-center mb-2">
                        <span class="badge bg-danger me-2">Nagad</span>
                        <small>Send Money (Personal)</small>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <h4 class="m-0 fw-bold">01761494948</h4>
                        <button class="btn btn-sm btn-outline-light" onclick="navigator.clipboard.writeText('01761494948')">Copy</button>
                    </div>
                </div>

                <input type="text" id="trxId" class="form-control bg-dark border-secondary text-white mb-3" placeholder="Transaction ID">
                <select id="planSelect" class="form-select bg-dark border-secondary text-white mb-4">
                    <option value="pro">Pro Plan (250‡ß≥)</option>
                    <option value="vip">VIP Plan (500‡ß≥)</option>
                </select>
                <button class="btn btn-laga w-100" onclick="submitPayment()">Verify Payment</button>
            </div>
        </div>
    </div>
</div>

<!-- Create Bot Modal -->
<div class="modal fade" id="createBotModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-card border-0" style="background: #18181b; color: white;">
            <div class="modal-body p-4">
                <h4 class="mb-4 fw-bold">Deploy New Bot</h4>
                <input id="botName" class="form-control bg-dark text-white border-secondary mb-3" placeholder="Bot Name">
                <input id="botToken" class="form-control bg-dark text-white border-secondary mb-4" placeholder="Bot Token (BotFather)">
                <button class="btn btn-laga w-100" onclick="createBot()">Launch System üöÄ</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

<script>
    lucide.createIcons();

    // --- LOGIC ---
    async function googleLogin() {
        try {
            const result = await auth.signInWithPopup(googleProvider);
            const token = await result.user.getIdToken();
            
            const res = await fetch('/api/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token })
            });
            const data = await res.json();
            
            if (data.error) {
                auth.signOut();
                alert(data.error); // Security Alert
            } else {
                initDashboard(token);
            }
        } catch (error) {
            console.error(error);
        }
    }

    function initDashboard(token) {
        document.getElementById('landingView').style.display = 'none';
        document.getElementById('dashboardView').style.display = 'block';
        localStorage.setItem('authToken', token);
        loadData();
    }

    async function loadData() {
        const token = localStorage.getItem('authToken');
        const res = await fetch('/api/dashboard', { headers: { 'Authorization': token } });
        const data = await res.json();

        if(data.error) return logout();

        // Stats & Plan
        document.getElementById('userPlanDisplay').innerText = data.plan.toUpperCase();
        document.getElementById('totalUsers').innerText = data.stats.total;
        document.getElementById('activeUsers').innerText = data.stats.active;
        document.getElementById('weeklyGrowth').innerText = "+" + data.stats.weekly;

        // Unlock Features
        if(data.plan !== 'free') {
            document.getElementById('lockLogs').classList.remove('feature-lock');
            document.getElementById('lockLogs').querySelector('.lock-icon').style.display = 'none';
        }
        if(data.plan === 'vip') {
            document.getElementById('lockSettings').classList.remove('feature-lock');
            document.getElementById('lockSettings').querySelector('.lock-icon').style.display = 'none';
        }

        // Bots
        const list = document.getElementById('botListContainer');
        list.innerHTML = '';
        if(data.bots.length === 0) list.innerHTML = '<div class="text-center text-muted py-4">No bots active</div>';
        
        data.bots.forEach(b => {
            const isRun = b.status === 'RUN';
            list.innerHTML += `
            <div class="glass-card p-3 d-flex justify-content-between align-items-center border-0" style="background: rgba(255,255,255,0.03)">
                <div>
                    <div class="fw-bold">${b.name}</div>
                    <small class="${isRun ? 'text-success':'text-danger'}">‚óè ${b.status}</small>
                </div>
                <button class="btn btn-sm ${isRun ? 'btn-outline-danger':'btn-outline-success'} rounded-pill" onclick="toggleBot('${b.id}', '${isRun?'stop':'start'}')">
                    <i data-lucide="${isRun?'power-off':'play'}" size="16"></i>
                </button>
            </div>`;
        });
        lucide.createIcons();
        renderChart(data.stats.weekly);
    }

    async function createBot() {
        const name = document.getElementById('botName').value;
        const token = document.getElementById('botToken').value;
        const uToken = localStorage.getItem('authToken');

        const res = await fetch('/api/createBot', {
            method: 'POST',
            headers: { 'Authorization': uToken, 'Content-Type': 'application/json' },
            body: JSON.stringify({ name, token })
        });
        const d = await res.json();
        if(d.error) alert(d.error);
        else {
            bootstrap.Modal.getInstance(document.getElementById('createBotModal')).hide();
            loadData();
        }
    }

    async function toggleBot(botId, action) {
        const uToken = localStorage.getItem('authToken');
        await fetch('/api/toggleBot', {
            method: 'POST', headers: {'Authorization': uToken, 'Content-Type': 'application/json'},
            body: JSON.stringify({ botId, action })
        });
        loadData();
    }

    async function submitPayment() {
        const trxId = document.getElementById('trxId').value;
        const plan = document.getElementById('planSelect').value;
        const uToken = localStorage.getItem('authToken');

        await fetch('/api/payment', {
            method: 'POST', headers: {'Authorization': uToken, 'Content-Type': 'application/json'},
            body: JSON.stringify({ trxId, plan, method: 'Nagad' })
        });
        alert('Payment submitted! Admin will verify soon.');
        bootstrap.Modal.getInstance(document.getElementById('paymentModal')).hide();
    }

    function logout() {
        auth.signOut();
        localStorage.removeItem('authToken');
        location.reload();
    }

    function renderChart(growth) {
        const ctx = document.getElementById('trafficChart').getContext('2d');
        // Gradient for chart
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(0, 229, 255, 0.5)');
        gradient.addColorStop(1, 'rgba(0, 229, 255, 0)');

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                datasets: [{
                    label: 'Activity',
                    data: [12, 19, 3, 5, 2, growth],
                    borderColor: '#00E5FF',
                    backgroundColor: gradient,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { color: 'rgba(255,255,255,0.05)' } },
                    y: { grid: { color: 'rgba(255,255,255,0.05)' } }
                }
            }
        });
    }

    auth.onAuthStateChanged(user => {
        if(user) initDashboard(localStorage.getItem('authToken'));
        else document.getElementById('landingView').style.display = 'flex';
    });
</script>
</body>
</html>
